---
import Layout from "../layouts/Layout.astro";
import Navbar from "../components/layout/Navbar.astro";
import Footer from "../components/layout/Footer.astro";
import SectionDivider from "../components/layout/SectionDivider.astro";
import WhatsAppFloatingButton from "../components/layout/WhatsAppFloatingButton.astro";
import SectionHero from "../components/common/sections/SectionHero.astro";
import ValueSection from "../components/common/sections/ValueSection.astro";
import PlansSection from "../components/marketing/PlansSection.astro";
import TrustSection from "../components/common/sections/TrustSection.astro";
import CtaFormSection from "../components/common/sections/CtaFormSection.astro";
import { fetchSiteSettings } from "../lib/api/services";
import type { Content, MarketingPageContent } from "../lib/api/types";
import contentJson from "../data/content.json";
import marketingJson from "../data/pages/marketing.json";

const siteSettings = await fetchSiteSettings();
const content = contentJson as Content;
const marketingContent = marketingJson as MarketingPageContent;

const { hero, value, plans, trust, cta, seo, plansSection } = marketingContent;
const pageTitle = seo?.title ?? "Marketing Digital para Pymes | Aliado Digital";
const pageDescription =
  seo?.description ??
  "Marketing digital enfocado en resultados reales para pymes, profesionales y negocios locales de Chile.";
---

<Layout
  title={pageTitle}
  description={pageDescription}
  siteSettings={siteSettings}
>
  <Navbar siteSettings={siteSettings} navLinks={content.navLinks} />
  <main class="overflow-x-hidden">
    <SectionHero
      sectionId="marketing-hero"
      title={hero.title}
      subtitle={hero.subtitle}
      primaryCta={hero.primaryCta}
      secondaryCta={hero.secondaryCta}
      imageSrc={hero.imageSrc}
      imageAlt={hero.imageAlt}
      slides={hero.slides}
    />

    <SectionDivider tone="accent" />

    <ValueSection
      title={value.title}
      description={value.description}
      quote={value.quote}
      items={value.items}
    />

    <SectionDivider />

    <PlansSection
      title={plansSection?.title ?? "Planes de marketing digital"}
      description={
        plansSection?.description ??
        "Elige el plan que mejor se ajuste a tu etapa. Todos priorizan resultados reales y crecimiento sostenido."
      }
      plans={plans}
    />

    <SectionDivider />

    <TrustSection
      title={trust.title}
      description={trust.description}
      logos={trust.logos}
    />

    <SectionDivider />

    <CtaFormSection
      title={cta.title}
      description={cta.description}
      ctaLabel={cta.ctaLabel}
      sectionId={cta.sectionId}
      formId={cta.formId}
    />
  </main>
  <Footer
    siteSettings={siteSettings}
    navLinks={content.navLinks}
    legalPages={content.legalPages}
  />
  <WhatsAppFloatingButton
    whatsappNumber={siteSettings.whatsappNumber}
    message="Hola! Quiero atraer mÃ¡s clientes con marketing digital."
  />
</Layout>
