---
import Layout from "../../layouts/Layout.astro";
import Navbar from "../../components/Navbar.astro";
import Footer from "../../components/Footer.astro";
import { fetchPostsPage, fetchSiteSettings } from "../../lib/api/services";

const { data: posts, pagination } = await fetchPostsPage({ page: 1, pageSize: 6 });
const siteSettings = await fetchSiteSettings();
const pageTitle = "Blog";
const pageLink = (pageNumber: number) => (pageNumber <= 1 ? "/blog" : `/blog/${pageNumber}`);
---

<Layout title={pageTitle} description={siteSettings.tagline} siteSettings={siteSettings}>
  <Navbar siteSettings={siteSettings} />
  <main class="section-shell py-16 space-y-10">
    <header class="space-y-2 max-w-2xl">
      <p class="pill w-fit bg-primary/10 border-primary/40 text-highlight">Blog</p>
      <h1 class="text-3xl sm:text-4xl font-bold text-content">Ideas y casos reales</h1>
      <p class="text-muted">Novedades sobre sitios Astro, automatizaciones y marketing local.</p>
    </header>

    <section class="grid md:grid-cols-2 gap-6">
      {posts.map((post) => (
        <article class="card flex flex-col gap-4">
          {post.cover?.url && (
            <img src={post.cover.url} alt={post.cover.alternativeText ?? post.title} class="h-48 w-full object-cover rounded-2xl" loading="lazy" />
          )}
          <div class="space-y-2">
            <h2 class="text-xl font-semibold text-content">{post.title}</h2>
            {post.excerpt && <p class="text-sm text-muted">{post.excerpt}</p>}
            <a class="text-sm font-semibold text-highlight hover:text-contrast" href={`/blog/${post.slug}`}>
              Leer articulo
            </a>
          </div>
        </article>
      ))}
    </section>

    {pagination.pageCount > 1 && (
      <nav class="flex items-center gap-3">
        {pagination.page > 1 && (
          <a class="text-sm font-semibold text-highlight hover:text-contrast" href={pageLink(pagination.page - 1)}>
            Anterior
          </a>
        )}
        <span class="text-sm text-muted/80">
          Pagina {pagination.page} de {pagination.pageCount}
        </span>
        {pagination.page < pagination.pageCount && (
          <a class="text-sm font-semibold text-highlight hover:text-contrast" href={pageLink(pagination.page + 1)}>
            Siguiente
          </a>
        )}
      </nav>
    )}
  </main>
  <Footer siteSettings={siteSettings} />
</Layout>
