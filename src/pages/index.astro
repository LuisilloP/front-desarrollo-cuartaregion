---
import Layout from "../layouts/Layout.astro";
import Navbar from "../components/layout/Navbar.astro";
import Hero from "../components/sections/Hero.astro";
import ServicesSection from "../components/sections/ServicesSection.astro";
import HostingSection from "../components/sections/HostingSection.astro";
import ProcessSection from "../components/sections/ProcessSection.astro";
import CasesSection from "../components/sections/CasesSection.astro";
import ReviewsSection from "../components/sections/ReviewsSection.astro";
import FAQSection from "../components/sections/FAQSection.astro";
import ContactSection from "../components/sections/ContactSection.astro";
import Footer from "../components/layout/Footer.astro";
import AboutUs from "../components/sections/AboutUs.astro";
import WhatsAppFloatingButton from "../components/layout/WhatsAppFloatingButton.astro";
import SectionDivider from "../components/layout/SectionDivider.astro";
import {
  fetchSiteSettings,
  fetchServices,
  fetchCases,
  fetchReviews,
  fetchFaqs,
} from "../lib/api/services";

// Import the new Content type for full type safety
import type { Content } from "../lib/api/types";
// Import the JSON data
import contentJson from "../data/content.json";

// Import the marquee component and its data
import PortfolioMarqueeSection from "../components/sections/PortfolioMarqueeSection.tsx";
import { companies as portfolioCompanies } from "../content/portfolioProjects";

// Cast the imported JSON to our new Content type
const staticContent = contentJson as Content;

const {
  heroSection,
  useCasesSection,
  reviewsSection,
  faqSection,
  contactSection,
  legalPages,
  navLinks,
} = staticContent;

const siteSettings = await fetchSiteSettings();
const services = await fetchServices();
const cases = await fetchCases();
const reviews = await fetchReviews();
const faqs = await fetchFaqs();

const recentCases = cases.slice(0, 3);
---

<Layout
  title={siteSettings.siteName}
  description={siteSettings.tagline}
  siteSettings={siteSettings}
>
  <Navbar siteSettings={siteSettings} navLinks={navLinks} />
  <main class="space-y-8 overflow-x-hidden max-w-full">
    <Hero siteSettings={siteSettings} content={heroSection} />

    {/* Pass all services to the section, not just featured ones */}
    <ServicesSection
      services={services}
      whatsappNumber={siteSettings.whatsappNumber}
    />

    <SectionDivider tone="accent" />

    {/* Social proof early - Cases show we deliver results */}
    <CasesSection cases={recentCases} />

    <SectionDivider />

    {/* How we work - Premium process section */}
    <ProcessSection />

    <SectionDivider />

    {/* More social proof - Portfolio companies */}
    <PortfolioMarqueeSection client:visible companies={portfolioCompanies} />

    <SectionDivider />

    {/* About Us after user is already interested */}
    <AboutUs />

    <SectionDivider />

    {/* Why choose us - Reinforcement */}
    <HostingSection content={useCasesSection} />

    <SectionDivider />

    {/* FAQ - Handle objections */}
    <FAQSection content={faqSection} faqs={faqs} />

    <SectionDivider />

    {/* Final CTA */}
    <ContactSection
      content={contactSection}
      whatsappNumber={siteSettings.whatsappNumber}
    />
  </main>
  <Footer
    siteSettings={siteSettings}
    navLinks={navLinks}
    legalPages={legalPages}
  />
  <WhatsAppFloatingButton
    whatsappNumber={siteSettings.whatsappNumber}
    message="Hola, me gustaría orientación para un proyecto web."
  />
</Layout>
