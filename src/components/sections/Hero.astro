---
import { Icon } from "astro-icon/components";
import type { SiteSettings, HeroSectionContent } from "../../lib/api/types";
import { getWhatsAppUrl } from "../../config/contact";
import HeroBackgroundSlideshow from "../hero/HeroBackgroundSlideshow.astro";

type Slide = {
  src: string;
  alt?: string;
  position?: string;
  mobileFocus?: "left" | "right" | "center";
};

interface Props {
  siteSettings: SiteSettings;
  content: HeroSectionContent;
  slides?: Slide[];
}

const { siteSettings, content, slides } = Astro.props as Props;
const whatsappUrl = getWhatsAppUrl(
  "Hola! Quiero potenciar mi web y automatizar ventas.",
  siteSettings.whatsappNumber,
);

const heroImages = [
  { src: "/images/sections/hero/hero-coquimbo.webp", alt: "Bahia y puerto de Coquimbo", position: "left" },
  { src: "/images/sections/hero/hero-serena.webp", alt: "Atardecer en La Serena", position: "right" },
  { src: "/images/sections/hero/hero-astro.webp", alt: "Cielo estrellado en Valle del Elqui", position: "left" },
  { src: "/images/sections/hero/hero-cielo.webp", alt: "Vista de La Serena desde el cielo", position: "center" },
];

const activeSlides = slides && slides.length > 0 ? slides : heroImages;
---

<section
  id="inicio"
  class="relative h-[100svh] min-h-[620px] w-full overflow-hidden max-[360px]:min-h-[560px] sm:min-h-[700px]"
>
  <!-- Background Slideshow -->
  <div class="absolute inset-0 z-0">
    <HeroBackgroundSlideshow
      slides={activeSlides}
      intervalMs={7000}
      transitionMs={1200}
    />
  </div>

  <!-- Dark Overlay -->
  <div
    class="absolute inset-0 z-10 bg-gradient-to-t from-black/70 via-black/50 to-transparent"
  >
  </div>

  <!-- Content -->
  <div
    class="hero-safe-offset relative z-20 flex h-full flex-col items-center justify-center px-4 pb-4 pt-0 text-center text-white max-[480px]:px-3 max-[480px]:pb-3 max-[360px]:pb-2"
  >
    <div class="flex max-w-4xl flex-col items-center gap-y-6 max-[480px]:gap-y-4 max-[360px]:gap-y-3">
      <div
        class="animate-fade-in-up inline-flex items-center gap-2 rounded-full border border-white/20 bg-white/10 px-4 py-2 text-sm backdrop-blur-sm max-[430px]:gap-1.5 max-[430px]:px-3 max-[430px]:py-1.5 max-[430px]:text-[11px] max-[360px]:gap-1 max-[360px]:px-2.5 max-[360px]:py-1 max-[360px]:text-[10px]"
      >
        <span class="relative flex h-2 w-2">
          <span
            class="animate-ping absolute inline-flex h-full w-full rounded-full bg-sky-300 opacity-75"
          ></span>
          <span class="relative inline-flex rounded-full h-2 w-2 bg-sky-400"
          ></span>
        </span>
        Tu aliado digital en la Región de Coquimbo
      </div>

      <h1
        class="mx-auto max-w-[18ch] text-[clamp(1.625rem,9.2vw,4.5rem)] font-bold leading-[1.06] tracking-tight text-white [text-wrap:balance] min-[481px]:max-w-none"
        style="animation: fade-in-in-up 0.8s 0.2s both cubic-bezier(0.25, 0.46, 0.45, 0.94);"
        aria-label="Te acompañamos a crecer con marketing digital y desarrollo web"
      >
        Te acompañamos a <span id="hero-typewriter"></span><span
          class="typewriter-cursor">|</span
        >
      </h1>

      <p
        class="max-w-[62ch] text-base leading-relaxed text-white/85 [text-wrap:pretty] max-[480px]:max-w-[34ch] max-[480px]:text-[0.98rem] max-[360px]:text-[0.92rem] sm:text-lg md:text-xl"
        style="animation: fade-in-up 0.8s 0.4s both cubic-bezier(0.25, 0.46, 0.45, 0.94);"
      >
        Desarrollo web, sistemas y marketing digital para pymes en Chile.
        Diseñamos sitios rápidos, automatizamos tareas y activamos campañas que
        convierten.
      </p>

      <div
        class="mx-auto flex w-full max-w-md flex-col items-center justify-center gap-3 max-[480px]:gap-2.5 sm:max-w-none sm:flex-row sm:flex-wrap sm:gap-4"
        style="animation: fade-in-up 0.8s 0.6s both cubic-bezier(0.25, 0.46, 0.45, 0.94);"
      >
        {whatsappUrl ? (
          <a
            href={whatsappUrl}
            target="_blank"
            rel="noopener noreferrer"
            aria-label="Contactar por WhatsApp"
            class="inline-flex min-h-11 w-full items-center justify-center gap-2 rounded-full bg-[#25D366] px-6 py-3.5 text-base font-semibold text-white shadow-lg transition-transform duration-200 hover:scale-105 sm:w-auto"
          >
            <Icon name="simple-icons:whatsapp" class="h-5 w-5" />
            <span>Contactar por WhatsApp</span>
          </a>
        ) : (
          <button
            type="button"
            disabled
            aria-label="WhatsApp no disponible"
            class="inline-flex min-h-11 w-full cursor-not-allowed items-center justify-center gap-2 rounded-full bg-[#25D366]/60 px-6 py-3.5 text-base font-semibold text-white/90 shadow-lg sm:w-auto"
          >
            <Icon name="simple-icons:whatsapp" class="h-5 w-5" />
            <span>Contactar por WhatsApp</span>
          </button>
        )}
        <a
          href="#servicios"
          aria-label="Ver soluciones"
          class="inline-flex min-h-11 w-full items-center justify-center gap-2 rounded-full border border-white/30 bg-white/10 px-6 py-3.5 text-base font-semibold text-white backdrop-blur-md transition-colors duration-200 hover:bg-white/20 max-[360px]:hidden sm:w-auto"
        >
          <span>Ver soluciones</span>
          <Icon name="lucide:arrow-right" class="h-4 w-4" />
        </a>
      </div>
    </div>
    <div class="mt-8 flex max-w-4xl items-center gap-6 max-[480px]:mt-6 max-[480px]:gap-4 max-[360px]:mt-4">
          {
            siteSettings.socialLinks.map((link) => (
              <a
                href={link.url}
                target="_blank"
                rel="noopener noreferrer"
                aria-label={`Visita nuestro perfil de ${link.name}`}
                class="text-slate-400 transition-colors hover:text-white"
              >
                <Icon name={link.icon} class="h-6 w-6 max-[360px]:h-5 max-[360px]:w-5" />
              </a>
            ))
          }
        </div>
  </div>
</section>

<script>
  import { initHeroTypewriter } from "../../scripts/ui/heroTypewriter";

  initHeroTypewriter({
    elementId: "hero-typewriter",
    cursorSelector: ".typewriter-cursor",
    text: "crecer con marketing digital y desarrollo web",
    speedMs: 50,
    startDelayMs: 500
  });
</script>

<style>
  @keyframes fade-in-up {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fade-in-up {
    animation: fade-in-up 0.8s both cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  /* Typewriter Cursor */
  .typewriter-cursor {
    display: inline-block;
    font-weight: 100; /* Thinner */
    color: inherit;
    margin-left: 2px;
    animation: blink 1s step-end infinite;
    opacity: 1;
  }

  @keyframes blink {
    0%,
    100% {
      opacity: 1;
    }
    50% {
      opacity: 0;
    }
  }
</style>

