---
import { Icon } from "astro-icon/components";
import { buildWhatsAppLink } from "../../lib/utils";

// Define a type for a single social link for clarity
interface SocialLink {
  name: string;
  url: string;
  icon: string;
}

// Define the shape of the content prop
interface Content {
  eyebrow: string;
  title: string;
  description: string;
  socialLinks: SocialLink[];
}

interface Props {
  content: Content;
  whatsappNumber: string;
}

const { content, whatsappNumber } = Astro.props;
const whatsappUrl = buildWhatsAppLink(
  whatsappNumber,
  "Hola! Quiero cotizar un proyecto.",
);
---

<section id="contacto" class="relative py-20 lg:py-32">
  <!-- Background Gradient -->
  <div
    class="absolute inset-x-0 top-0 h-1/2 bg-gradient-to-b from-slate-100 to-transparent dark:from-slate-900/80"
  >
  </div>

  <div
    id="contact-content"
    class="container mx-auto px-6 sm:px-8 relative z-10"
  >
    <div class="mx-auto max-w-3xl text-center">

      <!-- Title -->
      <h2
        class="text-4xl font-bold tracking-tight text-slate-900 dark:text-white sm:text-5xl"
      >
        {content.title}
      </h2>

      <!-- Description -->
      <p class="mt-4 text-lg text-slate-600 dark:text-white/60">
        {content.description}
      </p>

      <!-- Primary CTA -->
      <div class="mt-8">
        <a
          href={whatsappUrl}
          target="_blank"
          rel="noreferrer"
          class="inline-flex items-center justify-center gap-2 rounded-full bg-[#25D366] px-8 py-4 text-base font-semibold text-white shadow-lg transition-transform duration-200 hover:scale-105"
        >
          <Icon name="simple-icons:whatsapp" class="h-5 w-5" />
          <span>Cotizar por WhatsApp</span>
        </a>
      </div>

      <!-- Social Links -->
      <div class="mt-12">
        <p class="text-sm font-semibold text-slate-500 dark:text-white/40">
          Encu√©ntranos en nuestras redes
        </p>
        <div class="mt-4 flex justify-center gap-6">
          {
            content.socialLinks.map((link) => (
              <a
                href={link.url}
                target="_blank"
                rel="noreferrer"
                aria-label={`Visitar nuestro perfil de ${link.name}`}
                class="text-slate-500 transition-colors hover:text-slate-900 dark:text-slate-400 dark:hover:text-white"
              >
                <Icon name={link.icon} class="h-6 w-6" />
              </a>
            ))
          }
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  #contact-content {
    opacity: 0;
    transform: translateY(30px);
  }
  #contact-content.is-visible {
    opacity: 1;
    transform: translateY(0);
    transition:
      opacity 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94),
      transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const contactSection = document.getElementById("contact-content");
    if (!contactSection) return;

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            contactSection.classList.add("is-visible");
            observer.unobserve(contactSection);
          }
        });
      },
      {
        threshold: 0.1,
        rootMargin: "0px 0px -50px 0px",
      },
    );

    observer.observe(contactSection);
  });
</script>
