---
import { Icon } from "astro-icon/components";
import type {
  SiteSettings,
  NavLink,
  LegalPage,
  Content,
} from "../../lib/api/types";
import contentJson from "../../data/content.json";

interface Props {
  siteSettings: SiteSettings;
  navLinks?: NavLink[];
  legalPages?: {
    privacidad: LegalPage;
    terminos: LegalPage;
  };
}

const content = contentJson as Content;
const fallbackNavLinks = content.navLinks ?? [];
const fallbackLegalPages = content.legalPages ?? {};
const {
  siteSettings,
  navLinks = fallbackNavLinks,
  legalPages = fallbackLegalPages,
} = Astro.props;
const legalLinks = Object.values(legalPages ?? {});
const pathname = Astro.url?.pathname ?? "/";
const isHome = pathname === "/" || pathname === "";
const withHome = (href: string) =>
  href.startsWith("#") && !isHome ? `/${href}` : href;

const processedNavLinks = navLinks.map((link) => ({
  ...link,
  href: withHome(link.href),
}));
---

<footer class="bg-slate-900 text-white">
  <div class="container mx-auto px-6 sm:px-8 pt-16 pb-12">
    <div class="grid grid-cols-1 gap-12 md:grid-cols-2 lg:grid-cols-4">
      <!-- Column 1: Logo and Info -->
      <div class="md:col-span-2 lg:col-span-1">
        <!-- Logo -->
        <a
          href={withHome("/#inicio")}
          class:list={[
            "flex items-center gap-2 sm:gap-3 font-bold text-lg sm:text-xl tracking-tight transition-colors",
            isHome
              ? "text-white group-[.scrolled]:text-slate-900 dark:group-[.scrolled]:text-white"
              : "text-slate-900 dark:text-white",
          ]}
        >
          <div class="relative rounded-lg p-[1px]">
            <div class="rounded-lg">
              <img
                src="/logo.png"
                alt={`Logo de ${siteSettings.siteName}`}
                class="h-8 w-8 sm:h-10 sm:w-10 object-contain rounded-lg"
                loading="eager"
              />
            </div>
          </div>

          <span>{siteSettings.siteName}</span>
        </a>
        <p class="mt-4 text-sm text-slate-400">
          {siteSettings.footerText}
        </p>
      </div>

      <!-- Column 2: Navigation -->
      <div>
        <h3
          class="text-sm font-semibold tracking-wider uppercase text-slate-300"
        >
          Navegaci√≥n
        </h3>
        <ul class="mt-4 space-y-3">
          {
            navLinks.map((link) => (
              <li>
                <a
                  href={link.href}
                  class="text-slate-400 transition-colors hover:text-white"
                >
                  {link.label}
                </a>
              </li>
            ))
          }
        </ul>
      </div>

      <!-- Column 3: Legal -->
      <div>
        <h3
          class="text-sm font-semibold tracking-wider uppercase text-slate-300"
        >
          Legal
        </h3>
        <ul class="mt-4 space-y-3">
          {
            legalLinks.map((link) => (
              <li>
                <a
                  href={`/${link.slug}`}
                  class="text-slate-400 transition-colors hover:text-white"
                >
                  {link.title}
                </a>
              </li>
            ))
          }
        </ul>
      </div>

      <!-- Column 4: Social -->
      <div>
        <h3
          class="text-sm font-semibold tracking-wider uppercase text-slate-300"
        >
          Redes
        </h3>
        <div class="mt-4 flex gap-4">
          {
            siteSettings.socialLinks.map((link) => (
              <a
                href={link.url}
                target="_blank"
                rel="noreferrer"
                aria-label={`Visita nuestro perfil de ${link.name}`}
                class="text-slate-400 transition-colors hover:text-white"
              >
                <Icon name={link.icon} class="h-6 w-6" />
              </a>
            ))
          }
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Bar -->
  <div class="border-t border-slate-800">
    <div class="container mx-auto px-6 sm:px-8 py-6">
      <p class="text-center text-sm text-slate-500">
        &copy; {new Date().getFullYear()}
        {siteSettings.siteName}. Todos los derechos reservados.
      </p>
    </div>
  </div>
</footer>
