---
import { buildWhatsAppLink } from "../../lib/utils";
import { Icon } from "astro-icon/components";

interface Props {
  whatsappNumber: string;
  message?: string;
}

const { whatsappNumber, message } = Astro.props;
const whatsappUrl = buildWhatsAppLink(
  whatsappNumber,
  message ?? "Hola! Necesito una web o automatizacion.",
);
---

<a
  id="whatsapp-floating-button"
  href={whatsappUrl}
  target="_blank"
  rel="noopener noreferrer"
  class="fixed bottom-6 right-6 z-50 inline-flex items-center gap-2 rounded-full bg-[#25D366] text-white font-semibold shadow-2xl group focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/70"
  aria-label="WhatsApp"
>
  <Icon
    name="simple-icons:whatsapp"
    class="h-5 w-5 text-white"
    aria-hidden="true"
  />
  <span
    class="whitespace-nowrap overflow-hidden max-w-0 opacity-0 -translate-x-1 transition-all duration-300 text-sm
    group-hover:max-w-[220px] group-hover:opacity-100 group-hover:translate-x-0
    group-[.is-expanded]:max-w-[220px] group-[.is-expanded]:opacity-100 group-[.is-expanded]:translate-x-0"
  >
    Contactar por WhatsApp
  </span>
</a>

<style>
  #whatsapp-floating-button {
    --wa-offset-x: 0px;
    --wa-scale: 1;
    transform: translateX(var(--wa-offset-x)) scale(var(--wa-scale));
    transform-origin: center;
    will-change: transform;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    width: 52px;
    height: 52px;
    padding: 0;
    gap: 0;
    justify-content: center;
  }

  #whatsapp-floating-button:hover {
    --wa-scale: 1.02;
  }

  #whatsapp-floating-button:hover,
  #whatsapp-floating-button.is-expanded {
    width: auto;
    padding: 0.75rem 1rem;
    gap: 0.5rem;
  }

  @media (max-width: 640px) {
    #whatsapp-floating-button.is-expanded {
      --wa-offset-x: -4rem;
    }
  }
</style>
